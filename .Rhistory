mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)),
pop = ifelse(pop < 1 | is.na(pop), 1, pop),
hu = ifelse(hu < 1 | is.na(hu), 1, hu)) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["1990"]])) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .))
summary(tracts1990)
# fix bottom- and top-coding for beginning of period
tracts2000 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)),
pop = ifelse(pop < 1 | is.na(pop), 1, pop),
hu = ifelse(hu < 1 | is.na(hu), 1, hu)) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2000"]])) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .))
summary(tracts2000)
# make intervening years
tracts1991 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1991")
tracts1992 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1992")
tracts1993 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1993")
tracts1994 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1994")
tracts1995 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1995")
tracts1996 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1996")
tracts1997 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1997")
tracts1999 <- tracts2000 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "1999")
tracts9000 <- base::rbind(tracts1990, tracts1991, tracts1992, tracts1993, tracts1994, tracts1995, tracts1996, tracts1997, tracts1999, tracts2000)
rm(tracts1990, tracts1991, tracts1992, tracts1993, tracts1994, tracts1995, tracts1996, tracts1997, tracts1999)
summary(tracts9000)
# real interpolation 90-00 ####
# interpolate and then bottom-/top-code interpolated values
tracts9000 %<>%
group_by(trtid10) %>%
arrange(Year) %>%
mutate_at(all_of(varindex), ~na.approx(., na.rm = FALSE)) %>%
ungroup()
summary(tracts9000)
tracts9000 %<>%
mutate(prent = 100-pown)
tracts2010 <- neighborhoods %>%
select(c(1:8, ends_with("2a"))) %>%
mutate(Year = "2010")
names(tracts2010) <- gsub("2a", "", names(tracts2010))
tracts2010 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)),
pop = ifelse(pop < 1 | is.na(pop), 1, pop),
hu = ifelse(hu < 1 | is.na(hu), 1, hu)) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2010"]])) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .))
summary(tracts2010)
tracts2001 <- tracts2010 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "2001")
tracts2002 <- tracts2010 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "2002")
tracts2003 <- tracts2010 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "2003")
tracts2004 <- tracts2010 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "2004")
tracts2005 <- tracts2010 %>%
mutate_at(all_of(varindex), ~NA) %>%
mutate(Year = "2005")
tracts2006 <- tracts2005 %>%
mutate(Year = "2006")
tracts2007 <- tracts2005 %>%
mutate(Year = "2007")
tracts2008 <- tracts2005 %>%
mutate(Year = "2008")
tracts2009 <- tracts2005 %>%
mutate(Year = "2009")
tracts0010 <- base::rbind(
tracts2000, tracts2001, tracts2002, tracts2003, tracts2004, tracts2005, tracts2006, tracts2007, tracts2008, tracts2009, tracts2010)
rm(tracts2000, tracts2001, tracts2002, tracts2003, tracts2004, tracts2005, tracts2006, tracts2007, tracts2008, tracts2009)
74001*11
summary(tracts0010)
# test run ####
tracts <- unique(tracts0010$trtid10)[1:50]
tracts0010test <- tracts0010 %>%
filter(trtid10 %in% tracts)
tracts0010test1 <- tracts0010test %>%
arrange(Year) %>%
mutate_at(all_of(varindex), ~na.approx(., na.rm = FALSE))
tracts0010test2 <- tracts0010test %>%
group_by(trtid10) %>%
arrange(Year) %>%
mutate_at(all_of(varindex), ~na.approx(., na.rm = FALSE))
all.equal(tracts0010test1, tracts0010test2)
# visual test and comparison above: HAVE to group_by
rm(tracts, tracts0010test, tracts0010test1, tracts0010test2)
# real interpolation 00-10 ####
# interpolate and then bottom-/top-code interpolated values
tracts0010 %<>%
group_by(trtid10) %>%
arrange(Year) %>%
mutate_at(all_of(varindex), ~na.approx(., na.rm = FALSE)) %>%
ungroup()
tracts0010 %<>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .))
tracts0010 %<>%
mutate(prent = 100-pown)
summary(tracts0010)
# 10-17 ####
# 2019 $
tracts2017 <- neighborhoods %>%
select(c(1:8, ends_with("9a")))
names(tracts2010)[9:24] <- str_c(names(tracts2010)[9:24], "2a")
vars_money9a <- str_c(vars_money, "9a")
varindex9a <- str_c(varindex, "9a")
tracts2017 %<>%
mutate(mhmval9a = ifelse(mhmval9a < 10000 | is.na(mhmval9a), 9999,
ifelse(mhmval9a > 2000001, 2000001, mhmval9a)),
mrent9a = ifelse(mrent9a < 100 | is.na(mrent9a), 99,
ifelse(mrent9a > 3501, 3501, mrent9a)),
hinc9a = ifelse(hinc9a < 2500 | is.na(hinc9a), 2499,
ifelse(hinc9a > 250001, 250001, hinc9a)),
pop9a = ifelse(pop9a < 1 | is.na(pop9a), 1, pop9a),
hu9a = ifelse(hu9a < 1 | is.na(hu9a), 1, hu9a)) %>%
mutate_at(all_of(varindex9a[c(3:length(varindex9a)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex9a[c(3:length(varindex9a)-3)]), ~ifelse(. > 100, 100, .))
tracts1017 <- left_join(tracts2010, tracts2017 %>% select(trtid10, pop9a:hinc9a), by = "trtid10")
rm(tracts2010, tracts2017)
summary(tracts1017)
# separate varindex for percent versus whole values ####
pctvarindex <- c("pnhwht", "pnhblk", "phisp", "pmulti", "pcol", "ppov", "pprof",
"p20young", "pown", "pvac", "pfb")
varindex <- c("pop", "hu", "mhmval", "mrent", "hinc")
for (variable in pctvarindex) {
tracts1017[[paste0(variable, "_change")]] <-
((tracts1017[[paste0(variable, "9a")]] - tracts1017[[paste0(variable, "2a")]]))/7
tracts1017[[paste0(variable, "8a")]] <-
tracts1017[[paste0(variable, "9a")]]+tracts1017[[paste0(variable, "_change")]]
tracts1017[[paste0(variable, "2019")]] <-
tracts1017[[paste0(variable, "9a")]]+tracts1017[[paste0(variable, "_change")]]*2
}
for (variable in varindex) {
tracts1017[[paste0(variable, "_change")]] <-
((tracts1017[[paste0(variable, "9a")]] - tracts1017[[paste0(variable, "2a")]])/tracts1017[[paste0(variable, "2a")]])/7
tracts1017[[paste0(variable, "8a")]] <-
tracts1017[[paste0(variable, "9a")]]*(1+tracts1017[[paste0(variable, "_change")]])
tracts1017[[paste0(variable, "2019")]] <-
tracts1017[[paste0(variable, "9a")]]*(1+tracts1017[[paste0(variable, "_change")]])^2
}
tracts2017 <- tracts1017 %>%
select(c(1:8, ends_with("9a"))) %>%
mutate(Year = "2017",
prent9a = 100-pown9a)
names(tracts2017) <- gsub("9a", "", names(tracts2017))
# varindex of needed variables to top/bottom-code  ####
varindex <- c("pop", "hu", "pnhwht", "pnhblk", "phisp", "pmulti", "pcol", "ppov", "pprof",
"p20young", "pown", "pvac", "pfb", "mhmval", "mrent", "hinc")
tracts2018 <- tracts1017 %>%
select(c(1:8, ends_with("8a")))
names(tracts2018) <- gsub("8a", "", names(tracts2018))
tracts2018 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)),
pop = ifelse(pop < 1 | is.na(pop), 1, pop),
hu = ifelse(hu < 1 | is.na(hu), 1, hu),
Year = "2018") %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .)) %>%
mutate(prent = 100-pown)
tracts2019 <- tracts1017 %>%
select(c(1:8, ends_with("2019")))
names(tracts2019) <- gsub("2019", "", names(tracts2019))
tracts2019 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)),
pop = ifelse(pop < 1 | is.na(pop), 1, pop),
hu = ifelse(hu < 1 | is.na(hu), 1, hu),
Year = "2019") %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .)) %>%
mutate(prent = 100-pown)
tracts9019 <- base::rbind(tracts9000, tracts0010 %>% filter(Year != "2000"), tracts2017, tracts2018, tracts2019)
table(tracts0010$Year)
table(tracts9019$Year)
74001*23
summary(tracts9019)
# add in 2011-2016
neighborhoods <- read_csv('ltdb7010_acs1519_2010boundaries_merge_clean_full.csv')
#vars needed
#years needed
yearsindex <- c("3a", "4a", "5a", "6a", "7a", "8a")
varnames <- paste0(varindex, rep(yearsindex, each = length(varindex)))
varnames
tracts2011 <- neighborhoods %>%
select(c(1:8, ends_with("3a"))) %>%
mutate(Year = "2011",
prent3a = 100-pown3a) %>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)))
tracts2011 <- neighborhoods %>%
select(c(1:8, ends_with("3a"))) %>%
mutate(Year = "2011",
prent3a = 100-pown3a)
names(tracts2011) <- gsub("3a", "", names(tracts2011))
tracts2011 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2011"]]))
tracts2012 <- neighborhoods %>%
select(c(1:8, ends_with("4a"))) %>%
mutate(Year = "2012",
prent4a = 100-pown4a)
names(tracts2012) <- gsub("4a", "", names(tracts2012))
tracts2012 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2012"]]))
tracts2013 <- neighborhoods %>%
select(c(1:8, ends_with("5a"))) %>%
mutate(Year = "2013",
prent5a = 100-pown5a)
names(tracts2013) <- gsub("5a", "", names(tracts2013))
tracts2013 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2013"]]))
tracts2014 <- neighborhoods %>%
select(c(1:8, ends_with("6a"))) %>%
mutate(Year = "2014",
prent6a = 100-pown6a)
names(tracts2014) <- gsub("6a", "", names(tracts2014))
tracts2014 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2014"]]))
tracts2015 <- neighborhoods %>%
select(c(1:8, ends_with("7a"))) %>%
mutate(Year = "2015",
prent7a = 100-pown7a)
names(tracts2015) <- gsub("7a", "", names(tracts2015))
tracts2015 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2015"]]))
tracts2016 <- neighborhoods %>%
select(c(1:8, ends_with("8a"))) %>%
mutate(Year = "2016",
prent8a = 100-pown8a)
names(tracts2016) <- gsub("8a", "", names(tracts2016))
tracts2016 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2016"]]))
neighborhoods <- read_csv('ltdb7010_acs1519_2010boundaries_merge_clean_full.csv')
#vars needed
#years needed
yearsindex <- c("3a", "4a", "5a", "6a", "7a", "8a")
varnames <- paste0(varindex, rep(yearsindex, each = length(varindex)))
varnames
neighborhoods %<>%
select(c(1:8, all_of(varnames)))
names(neighborhoods)
tracts2011 <- neighborhoods %>%
select(c(1:8, ends_with("3a"))) %>%
mutate(Year = "2011",
prent3a = 100-pown3a)
names(tracts2011) <- gsub("3a", "", names(tracts2011))
tracts2011 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2011"]]))
tracts2012 <- neighborhoods %>%
select(c(1:8, ends_with("4a"))) %>%
mutate(Year = "2012",
prent4a = 100-pown4a)
names(tracts2012) <- gsub("4a", "", names(tracts2012))
tracts2012 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2012"]]))
tracts2013 <- neighborhoods %>%
select(c(1:8, ends_with("5a"))) %>%
mutate(Year = "2013",
prent5a = 100-pown5a)
names(tracts2013) <- gsub("5a", "", names(tracts2013))
tracts2013 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2013"]]))
tracts2014 <- neighborhoods %>%
select(c(1:8, ends_with("6a"))) %>%
mutate(Year = "2014",
prent6a = 100-pown6a)
names(tracts2014) <- gsub("6a", "", names(tracts2014))
tracts2014 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2014"]]))
tracts2015 <- neighborhoods %>%
select(c(1:8, ends_with("7a"))) %>%
mutate(Year = "2015",
prent7a = 100-pown7a)
names(tracts2015) <- gsub("7a", "", names(tracts2015))
tracts2015 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2015"]]))
tracts2016 <- neighborhoods %>%
select(c(1:8, ends_with("8a"))) %>%
mutate(Year = "2016",
prent8a = 100-pown8a)
names(tracts2016) <- gsub("8a", "", names(tracts2016))
tracts2016 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc))) %>%
mutate_at(all_of(vars_money), ~(.*cpi[["2016"]]))
tracts9019 <- base::rbind(tracts9019, tracts2011, tracts2012, tracts2013, tracts2014, tracts2015, tracts2016)
summary(tracts0019)
summary(tracts9019)
table(tracts9019$Year)
74001*27
74001*29
rm(tracts2011, tracts2012, tracts2013, tracts2014, tracts2015, tracts2016)
tracts9019 %<>%
group_by(trtid10) %>%
arrange(Year) %>%
mutate_at(all_of(varindex), ~na.approx(., na.rm = FALSE)) %>%
ungroup()
rm(tracts2011, tracts2012, tracts2013, tracts2014, tracts2015, tracts2016, tracts0010, tracts1017, tracts2017, tracts2018, tracts2019)
tracts9019 %<>%
mutate(prent = ifelse(is.na(prent), 100-pown, prent))
summary(tracts9019)
tracts9019 %<>%
mutate(mhmval = ifelse(mhmval < 10000 | is.na(mhmval), 9999,
ifelse(mhmval > 2000001, 2000001, mhmval)),
mrent = ifelse(mrent < 100 | is.na(mrent), 99,
ifelse(mrent > 3501, 3501, mrent)),
hinc = ifelse(hinc < 2500 | is.na(hinc), 2499,
ifelse(hinc > 250001, 250001, hinc)),
pop = ifelse(pop < 1 | is.na(pop), 1, pop),
hu = ifelse(hu < 1 | is.na(hu), 1, hu)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(is.na(.) | . < 0.1, 0.1, .)) %>%
mutate_at(all_of(varindex[c(3:length(varindex)-3)]), ~ifelse(. > 100, 100, .))
summary(tracts9019)
table(tracts9019$Year)
74001*29
write_csv(tracts9019, "acs_9019.csv")
rm(tracts9000, neighborhoods)
# get MSA income quartiles
tracts9019 %<>%
select(c(1:8, hinc, Year))
getwd()
cw2000s <- read_csv("/Users/ihzhang/Google Drive/My Drive/Stanford/PROJECT FOLDER/ Gentrification and PSID Displacement/PSID Displacement_RA/CBD data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("/Users/ihzhang/Google Drive/My Drive/Stanford/PROJECT FOLDER\/ Gentrification and PSID Displacement/PSID Displacement_RA/CBD data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("/Users/ihzhang/Google Drive/My Drive/Stanford/PROJECT FOLDER\\/ Gentrification and PSID Displacement/PSID Displacement_RA/CBD data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("/Users/ihzhang/Google Drive/My Drive/Stanford/PROJECT FOLDER\\\/ Gentrification and PSID Displacement/PSID Displacement_RA/CBD data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("/Users/ihzhang/Google Drive/My Drive/Stanford/PROJECT FOLDER\\/ Gentrification and PSID Displacement/PSID Displacement_RA/CBD data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("misc_data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("misc_data/cbsa_stcou_2013_cw.csv")
cw2000s <- read_csv("cbsa_stcou_2013_cw.csv")
library(read.dta13)
install.package("read.dta13")
install.packages("read.dta13")
cw1900s <- read.dta13("CBSA_STCOU_2009_cw.dta")
cw1900s <- read.dta("CBSA_STCOU_2009_cw.dta")
tracts9019 %<>%
mutate(stcou = substr(trtid10, 1, 5))
tracts9019 %<>%
mutate(metdiv10 = ifelse(is.na(metdiv10) | metdiv10 == "99999", cbsa10, metdiv10))
View(tracts9019)
tracts9019_na <- tracts9019 %>%
filter(is.na(metdiv10))
tracts9019 <- tracts9019 %>%
filter(!is.na(metdiv10))
?ntile
tracts9019_na %>%
tracts9019_na %<>%
group_by(metdiv10, Year) %>%
mutate(income4tile = ntile(hinc, 4, na.rm = T))
tracts9019_na %>%
group_by(metdiv10, Year) %>%
mutate(income4tile = ntile(hinc, 4, na.rm = T))
tracts9019_na %>%
group_by(stcou, Year) %>%
mutate(income4tile = ntile(hinc, 4, na.rm = T))
tracts9019_na %>%
group_by(stcou, Year) %>%
mutate(income4tile = ntile(hinc, 4))
tracts9019_na %>%
group_by(stcou, Year) %>%
mutate(income4tile = ntile(hinc, 4)) %>% View()
2499*2.08
tracts9019_na %<>%
group_by(stcou, Year) %>%
mutate(income4tile = ntile(hinc, 4))
tracts9019 %<>%
group_by(metdiv10, Year) %>%
mutate(income4tile = ntile(hinc, 4))
View(tracts9019)
tracts9019 <- base::rbind(tracts9019, tracts9019_na)
tracts9019_na <- tracts9019 %>%
group_by(stcou, Year) %>%
mutate(income4tile = ntile(hinc, 4)) %>%
filter(is.na(metdiv10))
tracts9019 %<>%
filter(!is.na(metdiv10)) %>%
group_by(metdiv10, Year) %>%
mutate(income4tile = ntile(hinc, 4))
tracts9019 <- base::rbind(tracts9019, tracts9019_na)
tracts9019_na <- tracts9019 %>%
group_by(stcou, Year) %>%
mutate(income4tile = ntile(hinc, 4)) %>%
ungroup() %>%
filter(is.na(metdiv10))
tracts9019 %<>%
filter(!is.na(metdiv10)) %>%
group_by(metdiv10, Year) %>%
mutate(income4tile = ntile(hinc, 4)) %>%
ungroup()
tracts9019 <- base::rbind(tracts9019, tracts9019_na)
74001*29
getwd()
write_csv(tracts9019, "inctile.csv")
rm(list = ls())
