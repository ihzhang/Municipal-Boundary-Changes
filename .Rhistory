axis.ticks.y = element_blank()) +
map_theme
nhb_00
nhb_00 <- ggplot() +
geom_sf(data = pl00, size = 0.25, color = "black", fill = "white") +
geom_sf(data = blk00, size = 0.1, aes(fill = nhblack00b)) +
scale_fill_gradient(low="grey77", high="grey31", breaks = breaks, limits = limits) +
geom_sf(data = annexed, size = 0.5, aes(fill = nhblack00b, color = "Annexed Block"), show.legend = "line") +
scale_color_manual(values = "red", guide = guide_legend(override.aes = list(fill = "transparent", color = "red"))) +
labs(fill = "% Non-Hispanic Black",
caption = "2000-2007") +
theme(legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_00
# 2007-2013
pl0713 <- read_csv("analyticalfiles/annexedblocks0713dem.csv") %>%
filter(plid==plids_viz)
# 2007 places
pl07 <- st_read("SHP_pl/2007/fe_2007_45_place.shp") %>%
filter(PLCIDFP %in% pl0713$plid) %>%
st_transform(., 3488)
buff07 <- read_csv("blocks2007_buffers.csv") %>%
filter(!duplicated(blkid))
cw <- read_csv("cw/2000-to-2010_unique.csv")
buff07 %<>%
left_join(cw, by = c("blkid" = "GEOID00")) %>%
filter(bufferplace %in% pl0713$plid & !is.na(GEOID10))
blk07 <- st_read("SHP_blk_0010/2007/states/SC_45_allblocks.shp") %>%
left_join(cw, by = c("BLKIDFP" = "GEOID00")) %>%
filter(!is.na(GEOID10) & GEOID10 %in% buff07$GEOID10) %>%
st_transform(., 3488) %>%
left_join(pl0713, by = c("GEOID10")) %>%
mutate_at(vars(nhblack:nbmin), ~ifelse(pop == 0, 0, ((./pop)*100)))
annexed <- blk07 %>%
filter(annexed == 1)
nhb_07 <- ggplot() +
geom_sf(data = pl07, size = 0.25, color = "black", fill = "white") +
geom_sf(data = blk07, size = 0.1, aes(fill = nhblack)) +
scale_fill_gradient(low="grey77", high="grey31", breaks = breaks, limits = limits) +
# geom_sf(data = annexed, size = 0.55, aes(fill = nhblack, color = "Annexed Block"), show.legend = "line") +
scale_color_manual(values = "red", guide = guide_legend(override.aes = list(fill = "transparent", color = "red"))) +
labs(fill = "% Non-Hispanic Black",
caption = "2007-2013 \n 41.5% Black") +
theme(legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_07
# 2014-2020
pl1420 <- read_csv("analyticalfiles/annexedblocks1420dem.csv") %>%
filter(plid==plids_viz)
# 2014 places
pl14 <- st_read("SHP_pl/2014/SC_45/tl_2014_45_place.shp") %>%
filter(GEOID %in% plids_viz) %>%
st_transform(., 3488)
blk14 <- st_read("SHP_blk_0010/2014/SC_45/tl_2014_45_tabblock10.shp") %>%
filter(GEOID10 %in% pl1420$blkid) %>%
filter(!duplicated(GEOID10)) %>%
st_transform(., 3488) %>%
left_join(pl1420, by = c("GEOID10" = "blkid")) %>%
mutate_at(vars(nhblack:nbmin), ~ifelse(pop == 0, 0, ((./pop)*100)))
# which were annexed in 2020
annexed <- blk14 %>%
filter(annexed == 1)
nhb_14 <- ggplot() +
geom_sf(data = blk14, size = 0.1, aes(fill = nhblack)) +
geom_sf(data = pl14, size = 0.25, color = "black", fill = "white") +
scale_fill_gradient(low="grey77", high="grey31", breaks =  breaks, limits = limits) +
# geom_sf(data = annexed, size = 0.5, aes(fill = nhblack, color = "Annexed Block"), show.legend = "line") +
scale_color_manual(values = "red", guide = guide_legend(override.aes = list(fill = "transparent", color = "red"))) +
labs(color='Annexed',
fill = "% Non-Hispanic Black",
caption = "2014-2020 \n 40.7% Black") +
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_14
leg <- as_ggplot(get_legend(nhb_14))
nhb_14 <- nhb_14 +
theme(legend.position = "none")
pl20 <- st_read("SHP_pl/2020/tl_2020_45_place.shp") %>%
filter(GEOID %in% plids_viz) %>%
st_transform(., 3488)
nhb_20 <- ggplot() +
geom_sf(data = pl20, size = 0.25, color = "black", fill = "white") +
labs(caption = "2020 \n 38.1% Black") +
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_20
nhb_attempt <- ggarrange(
plotlist = list(nhb_00, nhb_07, leg, nhb_14, nhb_20), ncol = 3, nrow = 2, widths = c(2, 1.4, 2))
nhb_attempt
# 2007 places
pl07 <- st_read("SHP_pl/2007/fe_2007_45_place.shp") %>%
filter(PLCIDFP %in% pl0713$plid) %>%
st_transform(., 3488)
buff07 <- read_csv("blocks2007_buffers.csv") %>%
filter(!duplicated(blkid))
cw <- read_csv("cw/2000-to-2010_unique.csv")
buff07 %<>%
left_join(cw, by = c("blkid" = "GEOID00")) %>%
filter(bufferplace %in% pl0713$plid & !is.na(GEOID10))
blk07 <- st_read("SHP_blk_0010/2007/states/SC_45_allblocks.shp") %>%
left_join(cw, by = c("BLKIDFP" = "GEOID00")) %>%
filter(!is.na(GEOID10) & GEOID10 %in% buff07$GEOID10) %>%
st_transform(., 3488) %>%
left_join(pl0713, by = c("GEOID10")) %>%
mutate_at(vars(nhblack:nbmin), ~ifelse(pop == 0, 0, ((./pop)*100)))
annexed <- blk07 %>%
filter(annexed == 1)
nhb_07 <- ggplot() +
geom_sf(data = pl07, size = 0.25, color = "black", fill = "white") +
geom_sf(data = blk07, size = 0.1, aes(fill = nhblack)) +
scale_fill_gradient(low="grey77", high="grey31", breaks = breaks, limits = limits) +
# geom_sf(data = annexed, size = 0.55, aes(fill = nhblack, color = "Annexed Block"), show.legend = "line") +
scale_color_manual(values = "red", guide = guide_legend(override.aes = list(fill = "transparent", color = "red"))) +
labs(fill = "% Non-Hispanic Black",
caption = "2007-2013") +
theme(legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_07
# 2014-2020
pl1420 <- read_csv("analyticalfiles/annexedblocks1420dem.csv") %>%
filter(plid==plids_viz)
# 2014 places
pl14 <- st_read("SHP_pl/2014/SC_45/tl_2014_45_place.shp") %>%
filter(GEOID %in% plids_viz) %>%
st_transform(., 3488)
blk14 <- st_read("SHP_blk_0010/2014/SC_45/tl_2014_45_tabblock10.shp") %>%
filter(GEOID10 %in% pl1420$blkid) %>%
filter(!duplicated(GEOID10)) %>%
st_transform(., 3488) %>%
left_join(pl1420, by = c("GEOID10" = "blkid")) %>%
mutate_at(vars(nhblack:nbmin), ~ifelse(pop == 0, 0, ((./pop)*100)))
# which were annexed in 2020
annexed <- blk14 %>%
filter(annexed == 1)
nhb_14 <- ggplot() +
geom_sf(data = blk14, size = 0.1, aes(fill = nhblack)) +
geom_sf(data = pl14, size = 0.25, color = "black", fill = "white") +
scale_fill_gradient(low="grey77", high="grey31", breaks =  breaks, limits = limits) +
# geom_sf(data = annexed, size = 0.5, aes(fill = nhblack, color = "Annexed Block"), show.legend = "line") +
scale_color_manual(values = "red", guide = guide_legend(override.aes = list(fill = "transparent", color = "red"))) +
labs(color='Annexed',
fill = "% Non-Hispanic Black",
caption = "2014-2020") +
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_14
leg <- as_ggplot(get_legend(nhb_14))
nhb_14 <- nhb_14 +
theme(legend.position = "none")
pl20 <- st_read("SHP_pl/2020/tl_2020_45_place.shp") %>%
filter(GEOID %in% plids_viz) %>%
st_transform(., 3488)
nhb_20 <- ggplot() +
geom_sf(data = pl20, size = 0.25, color = "black", fill = "white") +
labs(caption = "2020") +
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank(),
axis.ticks.y = element_blank()) +
map_theme
nhb_20
nhb_attempt <- ggarrange(
plotlist = list(nhb_00, nhb_07, leg, nhb_14, nhb_20), ncol = 3, nrow = 2, widths = c(2, 1.4, 2))
nhb_attempt
ggsave("analyticalfiles/final/Lockhart_SC_annex_0020.pdf",
plot = nhb_attempt)
panel0020_did <- read_csv("analyticalfiles/panel_prestandard.csv")
panel0020_did %<>%
mutate_at(vars(c(ends_with("total"), ends_with("_p0"), ends_with("_p1"), ends_with("_total_1"), contains("growth"), contains("_annexed"), ends_with("_log"), contains("diff"))),
~((.-mean(., na.rm = T))/sd(., na.rm = T)))
#annex or not ####
# lagged value
panel0020_did <- panel0020_did %>%
group_by(plid) %>%
arrange(plid, time) %>%
mutate(lag_annexed = dplyr::lag(annexing, 1, NA),
lag_annexed = ifelse(is.na(lag_annexed), 0, 1)) %>%
ungroup() #%>%
table(panel0020_did$time, panel0020_did$lag_annexed)
#annex or not ####
# lagged value
panel0020_did <- panel0020_did %>%
group_by(plid) %>%
arrange(plid, time) %>%
mutate(lag_annexed = dplyr::lag(annexing, 1, NA),
lag_annexed = ifelse(is.na(lag_annexed), 0, lag_annexed)) %>%
ungroup() #%>%
table(panel0020_did$time, panel0020_did$lag_annexed)
panel0020_did <- read_csv("analyticalfiles/panel_prestandard.csv")
#annex or not ####
# lagged value
panel0020_did <- panel0020_did %>%
group_by(plid) %>%
arrange(plid, time) %>%
mutate(lag_annexed = dplyr::lag(annexing, 1, NA),
lag_annexed = ifelse(is.na(lag_annexed), 0, lag_annexed)) %>%
ungroup() #%>%
# 1. time and annex (trends, outcomes) ####
# show p0 over time
vra_time <- panel0020_did %>%
mutate(vra = as.numeric(as.character(vra))) %>%
group_by(annexing, time, vra) %>%
mutate(n = n()) %>%
ungroup() %>%
group_by(annexing, time, vra, n) %>%
summarize_at(vars(c(contains("p0"), ends_with("growth"), ends_with("_total"), ends_with("_total_1"), ends_with("_diff"), more_white, lag_annexed)), ~mean(., na.rm = T)) %>%
t() %>%
as.data.frame() %>%
tibble::rownames_to_column(., "variable")
# just look at VRA places ####
annex_time_vra <- panel0020_did %>%
mutate(vra = as.numeric(as.character(vra))) %>%
group_by(annexing, time, vra) %>%
mutate(n = n()) %>%
ungroup() %>%
group_by(annexing, time, vra, n) %>%
summarize_at(vars(c(contains("p0"), contains("p1"), ends_with("growth"), ends_with("total"), contains("diff"))), ~mean(., na.rm = T)) %>%
t() %>%
as.data.frame() %>%
tibble::rownames_to_column(., "variable")
# fringe by annex
# show p0 over time
annex_time <- panel0020_did %>%
group_by(time, annexing) %>%
mutate(n = n()) %>%
ungroup() %>%
group_by(time, annexing, n) %>%
summarize_at(vars(c(contains("p0"), ends_with("growth"), ends_with("_total"), ends_with("_total_1"), ends_with("_diff"), more_white, vra)), ~mean(., na.rm = T)) %>%
t() %>%
as.data.frame() %>%
tibble::rownames_to_column(., "variable")
sd_outcome <- panel0020_did %>%
summarize_at(vars(ends_with("_p1")), ~sd(., na.rm = T)) %>%
t() %>%
as.data.frame() %>%
tibble::rownames_to_column(., "variable")
x <- list(vra_time, annex_time_vra, annex_time, sd_outcome)
write.xlsx(x, "analyticalfiles/annex_time_desc_vra.xlsx", rowNames = T)
# fringe by annex
# show p0 over time
annex_time <- panel0020_did %>%
group_by(time, annexing) %>%
mutate(n = n()) %>%
ungroup() %>%
group_by(time, annexing, n) %>%
summarize_at(vars(c(contains("p0"), ends_with("growth"), ends_with("_total"), ends_with("_total_1"), ends_with("_diff"), more_white, vra, lag_annexed)), ~mean(., na.rm = T)) %>%
t() %>%
as.data.frame() %>%
tibble::rownames_to_column(., "variable")
x <- list(vra_time, annex_time_vra, annex_time, sd_outcome)
write.xlsx(x, "analyticalfiles/annex_time_desc_vra.xlsx", rowNames = T)
rm(list = ls())
neighborhoods <- read_csv('ltdb7010_acs1317_2010b_gentvars_clean_addacs0812.csv')
homedir <- paste0(dirname(rstudioapi::getSourceEditorContext()$path))
workdir <- paste0("/../misc_data/")
setwd(paste0(homedir, workdir))
library(tidyverse)
library(foreign)
library(readr)
rm(list = ls())
neighborhoods <- read_csv('ltdb7010_acs1317_2010b_gentvars_clean_addacs0812.csv')
gent <- read_csv('gent_measures_707a_2010b.csv')
gent <- gent %>%
select(trtid10, ccflag, (contains("007a.2000") | contains("00.2000"))) %>%
select(trtid10, ccflag, (contains("fm") | contains("dhd"))) %>%
select(-((contains("40") | contains("gentcat") | contains("alt"))))
names(neighborhoods)
gentlong <- gent %>%
pivot_longer(cols = contains("."),
names_to = c(".value", "Year"),
names_sep = "\\.",
values_drop_na = F) %>%
mutate(trtid10 = str_pad(trtid10, 11, "left", "0"))
neighborhoods <- neighborhoods %>%
select(trtid10, (ends_with("00") | ends_with("7a")))
nh <- full_join(neighborhoods, gentlong, by = "trtid10")
names(nh)
neighborhoods <- neighborhoods %>%
select(trtid10, metdiv, (ends_with("00") | ends_with("7a")))
neighborhoods <- read_csv('ltdb7010_acs1317_2010b_gentvars_clean_addacs0812.csv')
neighborhoods <- neighborhoods %>%
select(trtid10, metdiv, (ends_with("00") | ends_with("7a")))
nh <- full_join(neighborhoods, gentlong, by = "trtid10")
nh %>%
filter(is.na(dhd_abledum50c_00))
table(nh$metdiv[is.na(nh$dhd_abledum50c_00), nh$dhd_abledum50c_00[is.na(nh$dhd_abledum50c_00)]])
table(nh$metdiv[is.na(nh$dhd_abledum50c_00)], nh$dhd_abledum50c_00[is.na(nh$dhd_abledum50c_00)])
length(!is.na(nh$metdiv))
table(nh$metdiv, exclude = NULL)
table(is.na(nh$metdiv))
7629/67154
67154+6847
nh <- nh %>%
filter(!is.na(dhd_abledum50c_00) & !is.na(fm_abledum50_00)) # should be 66372
nh <- nh %>%
mutate(ntypefm = ifelse(is.na(fm50_gentdum_007a) & ccflag==0, "Nongentrifiable Non-city_FM",
ifelse(is.na(fm50_gentdum_007a) & ccflag==1, "Nongentrifiable City_FM",
ifelse(fm50_gentdum_007a==1, "Gentrifying_FM", "Nongentrifying_FM"))),
ntypefm = factor(ntypefm, levels = c("Nongentrifiable Non-city_FM", "Nongentrifiable City_FM",
"Gentrifying_FM", "Nongentrifying_FM")),
ntyperve = ifelse(is.na(dhd_rve_gentdumc_007a) & ccflag==0, "Nongentrifiable Non-city_RVE",
ifelse(is.na(dhd_rve_gentdumc_007a) & ccflag==1, "Nongentrifiable City_RVE",
ifelse(dhd_rve_gentdumc_007a==1, "Gentrifying_RVE", "Nongentrifying_RVE"))),
ntyperve = factor(ntyperve, levels = c("Nongentrifiable Non-city_RVE", "Nongentrifiable City_RVE",
"Gentrifying_RVE", "Nongentrifying_RVE")),
ntypedhdc = ifelse(is.na(dhdc_gentdum_007a) & ccflag==0, "Nongentrifiable Non-city_DHDC",
ifelse(is.na(dhdc_gentdum_007a) & ccflag==1, "Nongentrifiable City_DHDC",
ifelse(dhdc_gentdum_007a==1, "Gentrifying_DHDC", "Nongentrifying_DHDC"))),
ntypedhdc = factor(ntypedhdc, levels = c("Nongentrifiable Non-city_DHDC", "Nongentrifiable City_DHDC",
"Gentrifying_DHDC", "Nongentrifying_DHDC")),
ntypedhdm = ifelse(is.na(dhdm_gentdum_007a) & ccflag==0, "Nongentrifiable Non-city_DHDM",
ifelse(is.na(dhdm_gentdum_007a) & ccflag==1, "Nongentrifiable City_DHDM",
ifelse(dhdm_gentdum_007a==1, "Gentrifying_DHDM", "Nongentrifying_DHDM"))),
ntypedhdm = factor(ntypedhdm, levels = c("Nongentrifiable Non-city_DHDM", "Nongentrifiable City_DHDM",
"Gentrifying_DHDM", "Nongentrifying_DHDM")))
cpi <- c(1.53,1.04)
nh <- nh %>%
mutate(hinci00 = hinc00*cpi[1],
mhmvali00 = mhmval00*cpi[1],
mrenti00 = mrent00*cpi[1],
hinci7a = hinc7a*cpi[2],
mhmvali7a = mhmval7a*cpi[2],
mrenti7a = mrent7a*cpi[2])
varindex = c("pop00", "pop7a", "hu00", "hu7a", "pnhwht00", "pnhwht7a", "pnhblk00", "pnhblk7a", "phisp00", "phisp7a",
"pasian00", "pasian7a", "hinci00", "hinci7a", "pcol00", "pcol7a", "ppov00", "ppov7a",
"pprof00", "pprof7a", "mhmvali00", "mhmvali7a", "mrenti00", "mrenti7a", "p20young00", "p20young7a",
"pown00", "pown7a", "ntyperve", "ntypefm", "ntypedhdc", "ntypedhdm") #variables to keep
nh <- nh %>%
select(trtid10, ccflag, all_of(varindex))
varindex = c("pop", "hu", "pnhwht", "pnhblk", "phisp", "pasian", "hinci", "pcol", "ppov", "pprof",
"mhmvali", "mrenti", "p20young", "pown") # create change variables
for (variable in varindex) {
varname <- paste0(variable, "_change")
nh[[varname]] <- nh[[paste0(variable, "7a")]] - nh[[paste0(variable, "00")]]
}
for (var in varindex) {
if (var == "pop") {
varindex_desc <- c(paste0(var, "00"), paste0(var, "_change"))
} else {
varindex_desc <- c(varindex_desc, c(paste0(var, "00"), paste0(var, "_change")))
}
}
# do this for FM
for (i in varindex_desc) {
test <- as.data.frame(nh %>%
group_by(ntypefm) %>%
summarize(mean = mean(.data[[i]], na.rm = T)))
names(test)[2] = paste0("mean_", i)
if (i == "pop00") {
ninfofm <- as.data.frame(test)
names(ninfofm) <- names(test)
} else {
ninfofm <- left_join(ninfofm, test, by = "ntypefm")
}
}
# do this for dhdc
for (i in varindex_desc) {
test <- as.data.frame(nh %>%
group_by(ntypedhdc) %>%
summarize(mean = mean(.data[[i]], na.rm = T)))
names(test)[2] = paste0("mean_", i)
if (i == "pop00") {
ninfodhdc <- as.data.frame(test)
names(ninfodhdc) <- names(test)
} else {
ninfodhdc <- left_join(ninfodhdc, test, by = "ntypedhdc")
}
}
# do this for dhdm
for (i in varindex_desc) {
test <- as.data.frame(nh %>%
group_by(ntypedhdm) %>%
summarize(mean = mean(.data[[i]], na.rm = T)))
names(test)[2] = paste0("mean_", i)
if (i == "pop00") {
ninfodhdm <- as.data.frame(test)
names(ninfodhdm) <- names(test)
} else {
ninfodhdm <- left_join(ninfodhdm, test, by = "ntypedhdm")
}
}
# rve
for (i in varindex_desc) {
test <- as.data.frame(nh %>%
group_by(ntyperve) %>%
summarize(mean = mean(.data[[i]], na.rm = T)))
names(test)[2] = paste0("mean_", i)
if (i == "pop00") {
ninforve <- as.data.frame(test)
names(ninforve) <- names(test)
} else {
ninforve <- left_join(ninforve, test, by = "ntyperve")
}
}
# transpose everything
ninfofm <- rownames_to_column(as.data.frame(t(ninfofm)), var = "descriptive_name")
ninfodhdc <- rownames_to_column(as.data.frame(t(ninfodhdc)), var = "descriptive_name")
ninfodhdm <- rownames_to_column(as.data.frame(t(ninfodhdm)), var = "descriptive_name")
ninforve <- rownames_to_column(as.data.frame(t(ninforve)), var = "descriptive_name")
# update column names - UAR
names(ninfofm) <- c("gentdum", "Nongentrifiable_FM", "Gentrifying_FM", "Non-Gentrifying_FM")
ninfofm <- ninfofm[-1, ]
names(ninfodhdc) <- c("gentdum", "Nongentrifiable_DHDC", "Gentrifying_DHDC", "Non-Gentrifying_DHDC")
ninfodhdc <- ninfodhdc[-1, ]
names(ninfodhdm) <- c("gentdum", "Nongentrifiable_DHDM", "Gentrifying_DHDM",  "Non-Gentrifying_DHDM")
ninfodhdm <- ninfodhdm[-1, ]
names(ninforve) <- c("gentdum", "Nongentrifiable_RVE", "Gentrifying_RVE",  "Non-Gentrifying_RVE")
ninforve <- ninforve[-1, ]
View(ninforve)
neighborhoods <- read_csv('ltdb7010_acs1317_2010b_gentvars_clean_addacs0812.csv')
gent <- read_csv('gent_measures_707a_2010b.csv')
gent <- gent %>%
select(trtid10, ccflag, (contains("007a.2000") | contains("00.2000"))) %>%
select(trtid10, ccflag, (contains("fm") | contains("dhd"))) %>%
select(-((contains("40") | contains("gentcat") | contains("alt"))))
gentlong <- gent %>%
pivot_longer(cols = contains("."),
names_to = c(".value", "Year"),
names_sep = "\\.",
values_drop_na = F) %>%
mutate(trtid10 = str_pad(trtid10, 11, "left", "0"))
neighborhoods <- neighborhoods %>%
select(trtid10, metdiv, (ends_with("00") | ends_with("7a")))
nh <- full_join(neighborhoods, gentlong, by = "trtid10")
#tracts excluded from analysis - should be the same across measures
table(nh$dhd_abledum50c_00, exclude = NULL)
table(nh$fm_abledum50_00, exclude = NULL)
table(nh$dhd_abledum50m_00, exclude = NULL)
table(is.na(nh$metdiv))
67154+6847
# how many tracts should we still have?
74001 - 7629
# city tracts excluded
7629/67154
nh <- nh %>%
filter(!is.na(dhd_abledum50c_00) & !is.na(fm_abledum50_00)) # should be 66372
nh$pnhblk00
nh %<>%
mutate(majbflag = ifelse(pnhblk00 >= 50, 1, 0))
# pct of gent and non-gent tracts that are majority black in 2000
nh %>% filter(dhd_rve_gentdumc_007a == 1 & majbflag == 1) %>% length()
# pct of gent and non-gent tracts that are majority black in 2000
table(nh$dhd_rve_gentdumc_007a)
55/3512
nh %>% filter(dhd_rve_gentdumc_007a == 0 & majbflag == 1) %>% length()
table(nh$ccflag))
table(nh$ccflag)
# city tracts excluded
7629/27759
nh %>% filter(dhd_rve_gentdumc_007a == 1 & majbflag == 1)
nh %>% filter(dhd_rve_gentdumc_007a == 1 & majbflag == 1) %>% nrow()
817/3512
nh %>% filter(dhd_rve_gentdumc_007a == 0 & majbflag == 1) %>% nrow()
# pct of gent and non-gent tracts that are majority black in 2000
table(nh$dhd_rve_gentdumc_007a)
nh %>% filter(dhd_rve_gentdumc_007a == 0 & majbflag == 1) %>% nrow()
2617/10060
rm(list = ls())
library("tidyverse")
library("readr")
# I like using the %<>% from magrittr; `x %<>% mutate` is equivalent to `x <- x %>% mutate`
library("magrittr")
library("data.table")
# Directories:
homedir <- paste0(dirname(rstudioapi::getSourceEditorContext()$path))
workdir <- paste0("/../misc_data/")
setwd(paste0(homedir, workdir))
setwd("~/Google Drive/My Drive/Stanford/aff_housing")
# Import data:
# the illinois file from CL
il <- fread("Illinois.csv", nrow = 25)
# Main Script -------------------------------------------------------------
df_names <- names(il)
df_names
# FIPS_CODE, UNFORMATTED_APN, CENSUS_TRACT, BLOCK_NUMBER, BUILDING_CODE, NUMBER_OF_UNITS, UNITS_NUMBER, OWNER_CORPORATE_INDICATOR, TRANSACTION_TYPE
# All the owner information
c(1, 2, 3, 14, 51, 119:144, 178)
il <- fread("Illinois.csv",
select = c(1, 2, 3, 14, 51, 78:79, 95, 119:144, 178))
# just cook county
il %<>%
filter(FIPS_CODE == "17031" & OWNER_CORPORATE_INDICATOR == "Y")
# just SFH (use CL's proprietary categorization) that are not owner-occupied
table(il$PROPERTY_INDICATOR)
sfh <- il %>%
filter(PROPERTY_INDICATOR == "10" & ABSENTEE_OWNER_STATUS != "O")
View(sfh)
df_names
# FIPS_CODE, UNFORMATTED_APN, CENSUS_TRACT, BLOCK_NUMBER, BUILDING_CODE, NUMBER_OF_UNITS, UNITS_NUMBER, OWNER_CORPORATE_INDICATOR, TRANSACTION_TYPE
# All the owner information, property info., some kind of date info.,
c(1, 2, 3, 8, 14, 35, 37, 51, 103:118, 119:144, 173:177, 178)
